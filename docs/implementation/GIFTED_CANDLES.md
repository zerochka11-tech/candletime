# üéÅ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–¥–∞—Ä–æ—á–Ω—ã—Ö —Å–≤–µ—á–µ–π –∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–ü—Ä–æ–µ–∫—Ç:** CandleTime - —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–∞—Ä–æ—á–Ω—ã—Ö —Å–≤–µ—á–µ–π

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏](#–æ–±–∑–æ—Ä-–∫–æ–Ω—Ü–µ–ø—Ü–∏–∏)
2. [–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏](#–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ-—Å—Ü–µ–Ω–∞—Ä–∏–∏)
3. [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
4. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Ä–µ—à–µ–Ω–∏—è)
5. [–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö](#–∏–∑–º–µ–Ω–µ–Ω–∏—è-–≤-–±–∞–∑–µ-–¥–∞–Ω–Ω—ã—Ö)
6. [–î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è](#–¥–µ—Ç–∞–ª—å–Ω–∞—è-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
7. [Email —Å–∏—Å—Ç–µ–º–∞](#email-—Å–∏—Å—Ç–µ–º–∞)
8. [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã-–∏-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–∫–æ–¥–∞)
9. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∞–Ω—Ç–∏—Å–ø–∞–º](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å-–∏-–∞–Ω—Ç–∏—Å–ø–∞–º)
10. [–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è](#–ø–æ—à–∞–≥–æ–≤–∞—è-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è-–≤–Ω–µ–¥—Ä–µ–Ω–∏—è)

---

## üéØ –û–±–∑–æ—Ä –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### –¶–µ–ª—å
–ü–æ–∑–≤–æ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º "–¥–∞—Ä–∏—Ç—å" —Å–≤–µ—á–∏ –¥—Ä—É–≥–∏–º –ª—é–¥—è–º, —Å–æ–∑–¥–∞–≤–∞—è:
- –í–∏—Ä—É—Å–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º —Ä–æ—Å—Ç–∞ —á–µ—Ä–µ–∑ –æ—Ä–≥–∞–Ω–∏—á–Ω–æ–µ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ
- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é —Å–≤—è–∑—å –º–µ–∂–¥—É –ª—é–¥—å–º–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã—Ä–∞–∑–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É, –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å, –ø–∞–º—è—Ç—å
- –ü—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –ø–æ–∑–¥—Ä–∞–≤–∏—Ç—å –∏–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –±–ª–∏–∑–∫–∏—Ö

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –ª–µ–≥–∫–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–≤–µ—á—É –ª—é–±–æ–º—É –ø–æ email
- **–ö—Ä–∞—Å–æ—Ç–∞** - –∫—Ä–∞—Å–∏–≤—ã–µ email-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è —Å –ø—Ä–µ–≤—å—é
- **–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å** - –¥–∞—Ä–∏—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Å—Ç–∞—Ç—å—Å—è –∞–Ω–æ–Ω–∏–º–Ω—ã–º
- **–ì–∏–±–∫–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏ –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ë–µ–∑ —Å–ø–∞–º–∞** - –∑–∞—â–∏—Ç–∞ –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π

### –ë–∏–∑–Ω–µ—Å-–≤—ã–≥–æ–¥—ã
- **–í–∏—Ä—É—Å–Ω—ã–π —Ä–æ—Å—Ç** - –∫–∞–∂–¥—ã–π –ø–æ–¥–∞—Ä–æ–∫ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **Retention** - –ø–æ–ª—É—á–∞—Ç–µ–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ–¥–∞—Ä–æ–∫
- **Engagement** - –¥–∞—Ä–∏—Ç–µ–ª–∏ –±–æ–ª–µ–µ –≤–æ–≤–ª–µ—á–µ–Ω—ã (—Å–æ–∑–¥–∞—é—Ç –±–æ–ª—å—à–µ —Å–≤–µ—á–µ–π)
- **–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–≤—è–∑—å** - —É–∫—Ä–µ–ø–ª—è–µ—Ç —Ü–µ–Ω–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞

---

## üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–¥–∞—Ä–æ–∫ –¥—Ä—É–≥—É
**–î–∞—Ä–∏—Ç–µ–ª—å:** –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  
**–ü–æ–ª—É—á–∞—Ç–µ–ª—å:** –ù–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  
**–î–µ–π—Å—Ç–≤–∏—è:**
1. –î–∞—Ä–∏—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç —Å–≤–µ—á—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏
2. –£–∫–∞–∑—ã–≤–∞–µ—Ç email –¥—Ä—É–≥–∞
3. –î–æ–±–∞–≤–ª—è–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç
5. –î—Ä—É–≥ –ø–æ–ª—É—á–∞–µ—Ç email —Å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ–º
6. –î—Ä—É–≥ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–≤–µ—á–∏ (–±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
7. –î—Ä—É–≥ –º–æ–∂–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–¥–∞—Ä–æ–∫ –∫–æ–ª–ª–µ–≥–µ
**–î–∞—Ä–∏—Ç–µ–ª—å:** –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  
**–ü–æ–ª—É—á–∞—Ç–µ–ª—å:** –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  
**–î–µ–π—Å—Ç–≤–∏—è:**
1. –î–∞—Ä–∏—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç —Å–≤–µ—á—É –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏
2. –£–∫–∞–∑—ã–≤–∞–µ—Ç email –∫–æ–ª–ª–µ–≥–∏
3. –ö–æ–ª–ª–µ–≥–∞ –ø–æ–ª—É—á–∞–µ—Ç email + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ —Å–∏—Å—Ç–µ–º–µ
4. –ö–æ–ª–ª–µ–≥–∞ –≤–∏–¥–∏—Ç –ø–æ–¥–∞—Ä–æ–∫ –≤ —Ä–∞–∑–¥–µ–ª–µ "–ú–Ω–µ –ø–æ–¥–∞—Ä–∏–ª–∏"

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ê–Ω–æ–Ω–∏–º–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫
**–î–∞—Ä–∏—Ç–µ–ª—å:** –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–≤—ã–±—Ä–∞–ª "–∞–Ω–æ–Ω–∏–º–Ω–æ")  
**–ü–æ–ª—É—á–∞—Ç–µ–ª—å:** –õ—é–±–æ–π  
**–î–µ–π—Å—Ç–≤–∏—è:**
1. –î–∞—Ä–∏—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç —Å–≤–µ—á—É
2. –í—ã–±–∏—Ä–∞–µ—Ç "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–Ω–æ–Ω–∏–º–Ω–æ"
3. –ü–æ–ª—É—á–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø–æ–¥–∞—Ä–æ–∫, –Ω–æ –Ω–µ –∑–Ω–∞–µ—Ç –æ—Ç –∫–æ–≥–æ

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –°–µ–º–µ–π–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫
**–î–∞—Ä–∏—Ç–µ–ª—å:** –û–¥–∏–Ω —á–µ–ª–æ–≤–µ–∫  
**–ü–æ–ª—É—á–∞—Ç–µ–ª–∏:** –ù–µ—Å–∫–æ–ª—å–∫–æ email-–∞–¥—Ä–µ—Å–æ–≤  
**–î–µ–π—Å—Ç–≤–∏—è:**
1. –î–∞—Ä–∏—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç —Å–≤–µ—á—É –ø–∞–º—è—Ç–∏
2. –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ email-–∞–¥—Ä–µ—Å–æ–≤ (—Å–µ–º—å—è)
3. –í—Å–µ –ø–æ–ª—É—á–∞—é—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ email-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è

---

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:
- **Next.js API Routes** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–¥–∞—Ä–∫–æ–≤
- **Resend** –∏–ª–∏ **SendGrid** - –æ—Ç–ø—Ä–∞–≤–∫–∞ email (—Ä–µ–∫–æ–º–µ–Ω–¥—É—é Resend –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã)
- **React Email** - —Å–æ–∑–¥–∞–Ω–∏–µ –∫—Ä–∞—Å–∏–≤—ã—Ö HTML email —à–∞–±–ª–æ–Ω–æ–≤
- **Supabase** - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–¥–∞—Ä–∫–∞—Ö
- **Zod** - –≤–∞–ª–∏–¥–∞—Ü–∏—è email –∏ –¥–∞–Ω–Ω—ã—Ö

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:
- **Nodemailer** + —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã (–±–æ–ª–µ–µ –≥–∏–±–∫–æ, –Ω–æ —Å–ª–æ–∂–Ω–µ–µ)
- **Mailgun** - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ SendGrid
- **Postmark** - —Ö–æ—Ä–æ—à–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö email

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏:
```bash
npm install resend @react-email/components @react-email/render zod
```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

```
components/
  gifts/
    GiftCandleForm.tsx          # –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–¥–∞—Ä–∫–∞
    GiftPreview.tsx             # –ü—Ä–µ–≤—å—é –ø–æ–¥–∞—Ä–∫–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
    GiftedCandlesList.tsx       # –°–ø–∏—Å–æ–∫ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –ø–æ–¥–∞—Ä–∫–æ–≤
    GiftedCandlesBadge.tsx      # –ë–µ–π–¥–∂ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ–¥–∞—Ä–∫–æ–≤
    GiftSenderInfo.tsx          # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–∞—Ä–∏—Ç–µ–ª–µ
  email/
    GiftInvitationEmail.tsx     # React Email —à–∞–±–ª–æ–Ω
app/
  api/
    gifts/
      send.ts                   # API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–¥–∞—Ä–∫–∞
      list.ts                   # API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤
      claim.ts                  # API –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è –ø–æ–¥–∞—Ä–∫–∞
  received/
    page.tsx                    # –°—Ç—Ä–∞–Ω–∏—Ü–∞ "–ú–Ω–µ –ø–æ–¥–∞—Ä–∏–ª–∏"
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:

```
User creates gift ‚Üí Validate ‚Üí Store in DB ‚Üí 
  ‚îî‚îÄ Send email ‚Üí Track status ‚Üí
    ‚îî‚îÄ Recipient opens ‚Üí Show candle page ‚Üí
      ‚îî‚îÄ Optional registration ‚Üí Claim gift
```

---

## üíæ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã candles

```sql
-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –¥–ª—è –ø–æ–¥–∞—Ä–∫–æ–≤
ALTER TABLE candles
ADD COLUMN IF NOT EXISTS is_gift BOOLEAN DEFAULT false,
ADD COLUMN IF NOT EXISTS gift_recipient_email TEXT,
ADD COLUMN IF NOT EXISTS gift_sender_message TEXT,
ADD COLUMN IF NOT EXISTS gift_sender_anonymous BOOLEAN DEFAULT false,
ADD COLUMN IF NOT EXISTS gift_sent_at TIMESTAMPTZ,
ADD COLUMN IF NOT EXISTS gift_opened_at TIMESTAMPTZ,
ADD COLUMN IF NOT EXISTS gift_claimed_at TIMESTAMPTZ,
ADD COLUMN IF NOT EXISTS gift_recipient_user_id UUID REFERENCES auth.users(id) ON DELETE SET NULL,
ADD COLUMN IF NOT EXISTS gift_token TEXT UNIQUE; -- –¢–æ–∫–µ–Ω –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
CREATE INDEX IF NOT EXISTS idx_candles_gift_recipient_email ON candles(gift_recipient_email) WHERE is_gift = true;
CREATE INDEX IF NOT EXISTS idx_candles_gift_token ON candles(gift_token) WHERE gift_token IS NOT NULL;
CREATE INDEX IF NOT EXISTS idx_candles_gift_recipient_user_id ON candles(gift_recipient_user_id) WHERE gift_recipient_user_id IS NOT NULL;

-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
COMMENT ON COLUMN candles.is_gift IS '–Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–≤–µ—á–∞ –ø–æ–¥–∞—Ä–∫–æ–º';
COMMENT ON COLUMN candles.gift_recipient_email IS 'Email –ø–æ–ª—É—á–∞—Ç–µ–ª—è –ø–æ–¥–∞—Ä–∫–∞';
COMMENT ON COLUMN candles.gift_sender_message IS '–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –¥–∞—Ä–∏—Ç–µ–ª—è';
COMMENT ON COLUMN candles.gift_sender_anonymous IS '–û—Å—Ç–∞–µ—Ç—Å—è –ª–∏ –¥–∞—Ä–∏—Ç–µ–ª—å –∞–Ω–æ–Ω–∏–º–Ω—ã–º';
COMMENT ON COLUMN candles.gift_token IS '–£–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ–¥–∞—Ä–∫—É';
```

### 2. –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–¥–∞—Ä–∫–æ–≤

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–æ–∫ –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Å–ø–∞–º–∞
CREATE TABLE IF NOT EXISTS gift_send_log (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  candle_id UUID REFERENCES candles(id) ON DELETE CASCADE,
  sender_id UUID REFERENCES auth.users(id) ON DELETE SET NULL,
  recipient_email TEXT NOT NULL,
  sent_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
  email_status TEXT DEFAULT 'pending', -- pending, sent, delivered, opened, failed
  error_message TEXT
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX IF NOT EXISTS idx_gift_send_log_sender ON gift_send_log(sender_id, sent_at);
CREATE INDEX IF NOT EXISTS idx_gift_send_log_recipient ON gift_send_log(recipient_email, sent_at);
CREATE INDEX IF NOT EXISTS idx_gift_send_log_status ON gift_send_log(email_status);

-- RLS –ø–æ–ª–∏—Ç–∏–∫–∏
ALTER TABLE gift_send_log ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can see own send log"
  ON gift_send_log FOR SELECT
  USING (auth.uid() = sender_id);
```

### 3. –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–∞

```sql
-- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –ø–æ–¥–∞—Ä–∫–∞
CREATE OR REPLACE FUNCTION generate_gift_token()
RETURNS TEXT AS $$
BEGIN
  -- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ç–æ–∫–µ–Ω –∏–∑ 32 —Å–∏–º–≤–æ–ª–æ–≤
  RETURN encode(gen_random_bytes(24), 'base64url');
END;
$$ LANGUAGE plpgsql;
```

---

## üíª –î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —É—Ç–∏–ª–∏—Ç—ã

```typescript
// lib/gifts.ts
import { z } from 'zod';
import crypto from 'crypto';

export const GiftCandleSchema = z.object({
  title: z.string().min(1).max(100),
  message: z.string().max(500).optional(),
  candle_type: z.enum(['calm', 'support', 'memory', 'gratitude', 'focus']),
  duration_hours: z.number().int().min(1).max(720),
  recipient_email: z.string().email(),
  sender_message: z.string().max(500).optional(),
  sender_anonymous: z.boolean().default(false),
});

export type GiftCandleInput = z.infer<typeof GiftCandleSchema>;

/**
 * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è –ø–æ–¥–∞—Ä–∫–∞
 */
export function generateGiftToken(): string {
  return crypto.randomBytes(24).toString('base64url');
}

/**
 * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –º–æ–∂–Ω–æ –ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫ (–∞–Ω—Ç–∏—Å–ø–∞–º)
 */
export async function canSendGift(
  senderId: string | null,
  recipientEmail: string
): Promise<{ allowed: boolean; reason?: string }> {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ù–µ–ª—å–∑—è –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–∞–º–æ–º—É —Å–µ–±–µ
  if (senderId) {
    const { data: user } = await supabase.auth.getUser();
    if (user?.user?.email?.toLowerCase() === recipientEmail.toLowerCase()) {
      return { allowed: false, reason: '–ù–µ–ª—å–∑—è –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–¥–∞—Ä–æ–∫ —Å–∞–º–æ–º—É —Å–µ–±–µ' };
    }
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: Rate limiting - –Ω–µ –±–æ–ª–µ–µ 10 –ø–æ–¥–∞—Ä–∫–æ–≤ –≤ —á–∞—Å –Ω–∞ –æ–¥–∏–Ω email
  const oneHourAgo = new Date(Date.now() - 60 * 60 * 1000);
  const { count } = await supabase
    .from('gift_send_log')
    .select('*', { count: 'exact', head: true })
    .eq('recipient_email', recipientEmail.toLowerCase())
    .gte('sent_at', oneHourAgo.toISOString());

  if (count && count >= 10) {
    return {
      allowed: false,
      reason: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–¥–∞—Ä–∫–æ–≤ —ç—Ç–æ–º—É –ø–æ–ª—É—á–∞—Ç–µ–ª—é. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.',
    };
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: Rate limiting –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è - –Ω–µ –±–æ–ª–µ–µ 20 –ø–æ–¥–∞—Ä–∫–æ–≤ –≤ –¥–µ–Ω—å
  if (senderId) {
    const todayStart = new Date();
    todayStart.setHours(0, 0, 0, 0);

    const { count: senderCount } = await supabase
      .from('gift_send_log')
      .select('*', { count: 'exact', head: true })
      .eq('sender_id', senderId)
      .gte('sent_at', todayStart.toISOString());

    if (senderCount && senderCount >= 20) {
      return {
        allowed: false,
        reason: '–í—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∞—Ä–∫–æ–≤ —Å–µ–≥–æ–¥–Ω—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≤—Ç—Ä–∞.',
      };
    }
  }

  return { allowed: true };
}
```

### 2. API Route –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–¥–∞—Ä–∫–∞

```typescript
// app/api/gifts/send/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { supabase } from '@/lib/supabaseClient';
import { GiftCandleSchema, generateGiftToken, canSendGift } from '@/lib/gifts';
import { sendGiftEmail } from '@/lib/email';

export async function POST(request: NextRequest) {
  try {
    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const {
      data: { user },
    } = await supabase.auth.getUser();

    // –ü–∞—Ä—Å–∏–º –∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
    const body = await request.json();
    const validatedData = GiftCandleSchema.parse(body);

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–Ω—Ç–∏—Å–ø–∞–º
    const spamCheck = await canSendGift(user?.id || null, validatedData.recipient_email);
    if (!spamCheck.allowed) {
      return NextResponse.json(
        { error: spamCheck.reason || '–û—Ç–ø—Ä–∞–≤–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞' },
        { status: 429 }
      );
    }

    // –°–æ–∑–¥–∞–µ–º —Å–≤–µ—á—É-–ø–æ–¥–∞—Ä–æ–∫
    const giftToken = generateGiftToken();
    const expiresAt = new Date();
    expiresAt.setHours(expiresAt.getHours() + validatedData.duration_hours);

    const { data: candle, error: candleError } = await supabase
      .from('candles')
      .insert({
        title: validatedData.title,
        message: validatedData.message || null,
        candle_type: validatedData.candle_type,
        duration_hours: validatedData.duration_hours,
        expires_at: expiresAt.toISOString(),
        status: 'active',
        is_gift: true,
        gift_recipient_email: validatedData.recipient_email.toLowerCase(),
        gift_sender_message: validatedData.sender_message || null,
        gift_sender_anonymous: validatedData.sender_anonymous || false,
        gift_token: giftToken,
        gift_sent_at: new Date().toISOString(),
        user_id: user?.id || null,
      })
      .select()
      .single();

    if (candleError) {
      console.error('Error creating gift candle:', candleError);
      return NextResponse.json(
        { error: '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–¥–∞—Ä–∫–∞' },
        { status: 500 }
      );
    }

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º email
    try {
      await sendGiftEmail({
        recipientEmail: validatedData.recipient_email,
        candleId: candle.id,
        giftToken,
        senderName: validatedData.sender_anonymous
          ? null
          : user?.email?.split('@')[0] || '–ö—Ç–æ-—Ç–æ',
        senderMessage: validatedData.sender_message,
        candleTitle: validatedData.title,
        candleMessage: validatedData.message,
        candleType: validatedData.candle_type,
      });
    } catch (emailError) {
      console.error('Error sending gift email:', emailError);
      // –ù–µ –±–ª–æ–∫–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–∞, –µ—Å–ª–∏ email –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏–ª—Å—è
      // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
    }

    // –õ–æ–≥–∏—Ä—É–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É
    await supabase.from('gift_send_log').insert({
      candle_id: candle.id,
      sender_id: user?.id || null,
      recipient_email: validatedData.recipient_email.toLowerCase(),
      email_status: 'sent',
    });

    return NextResponse.json({
      success: true,
      candleId: candle.id,
      message: '–ü–æ–¥–∞—Ä–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!',
    });
  } catch (error) {
    if (error instanceof z.ZodError) {
      return NextResponse.json(
        { error: '–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ', details: error.errors },
        { status: 400 }
      );
    }

    console.error('Error in send gift API:', error);
    return NextResponse.json(
      { error: '–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞' },
      { status: 500 }
    );
  }
}
```

---

## üìß Email —Å–∏—Å—Ç–µ–º–∞

### 1. React Email —à–∞–±–ª–æ–Ω

```typescript
// components/email/GiftInvitationEmail.tsx
import {
  Html,
  Head,
  Body,
  Container,
  Section,
  Text,
  Button,
  Img,
  Hr,
} from '@react-email/components';
import * as React from 'react';

interface GiftInvitationEmailProps {
  recipientName?: string;
  senderName?: string | null;
  senderMessage?: string | null;
  candleTitle: string;
  candleMessage?: string;
  candleType: string;
  giftUrl: string;
}

const candleTypeEmojis: Record<string, string> = {
  calm: 'üïäÔ∏è',
  support: 'ü§ù',
  memory: 'üåô',
  gratitude: '‚ú®',
  focus: 'üéØ',
};

const candleTypeLabels: Record<string, string> = {
  calm: '–°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ',
  support: '–ü–æ–¥–¥–µ—Ä–∂–∫–∞',
  memory: '–ü–∞–º—è—Ç—å',
  gratitude: '–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å',
  focus: '–§–æ–∫—É—Å',
};

export function GiftInvitationEmail({
  recipientName,
  senderName,
  senderMessage,
  candleTitle,
  candleMessage,
  candleType,
  giftUrl,
}: GiftInvitationEmailProps) {
  const emoji = candleTypeEmojis[candleType] || 'üïØÔ∏è';
  const typeLabel = candleTypeLabels[candleType] || '–°–≤–µ—á–∞';

  return (
    <Html>
      <Head />
      <Body style={main}>
        <Container style={container}>
          <Section style={header}>
            <Text style={headerText}>CandleTime</Text>
          </Section>

          <Section style={content}>
            <Text style={greeting}>
              {recipientName ? `–ü—Ä–∏–≤–µ—Ç, ${recipientName}!` : '–ü—Ä–∏–≤–µ—Ç!'}
            </Text>

            <Text style={paragraph}>
              {senderName ? (
                <>
                  <strong>{senderName}</strong> –ø–æ–¥–∞—Ä–∏–ª(–∞) —Ç–µ–±–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫—É—é —Å–≤–µ—á—É –Ω–∞
                  CandleTime.
                </>
              ) : (
                <>–¢–µ–±–µ –ø–æ–¥–∞—Ä–∏–ª–∏ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫—É—é —Å–≤–µ—á—É –Ω–∞ CandleTime.</>
              )}
            </Text>

            {senderMessage && (
              <Section style={messageBox}>
                <Text style={messageLabel}>–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –¥–∞—Ä–∏—Ç–µ–ª—è:</Text>
                <Text style={messageText}>{senderMessage}</Text>
              </Section>
            )}

            <Section style={candlePreview}>
              <Text style={candleEmoji}>{emoji}</Text>
              <Text style={candleTitleText}>{candleTitle}</Text>
              <Text style={candleTypeText}>{typeLabel}</Text>
              {candleMessage && (
                <Text style={candleMessageText}>{candleMessage}</Text>
              )}
            </Section>

            <Section style={buttonContainer}>
              <Button style={button} href={giftUrl}>
                –û—Ç–∫—Ä—ã—Ç—å –ø–æ–¥–∞—Ä–æ–∫
              </Button>
            </Section>

            <Hr style={divider} />

            <Text style={footerText}>
              –≠—Ç–æ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∞—è —Å–≤–µ—á–∞, –∑–∞–∂–∂–µ–Ω–Ω–∞—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ–±—è. –¢—ã –º–æ–∂–µ—à—å –æ—Ç–∫—Ä—ã—Ç—å –µ—ë
              –∏ —É–≤–∏–¥–µ—Ç—å –ø–æ—Å–ª–∞–Ω–∏–µ.
            </Text>

            <Text style={footerSmall}>
              –ï—Å–ª–∏ —Ç—ã –Ω–µ –æ–∂–∏–¥–∞–ª(–∞) —ç—Ç–æ–≥–æ –ø–∏—Å—å–º–∞, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä—É–π –µ–≥–æ.
            </Text>
          </Section>
        </Container>
      </Body>
    </Html>
  );
}

// –°—Ç–∏–ª–∏
const main = {
  backgroundColor: '#f6f9fc',
  fontFamily:
    '-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Ubuntu,sans-serif',
};

const container = {
  backgroundColor: '#ffffff',
  margin: '0 auto',
  padding: '20px 0 48px',
  maxWidth: '600px',
};

const header = {
  padding: '32px 24px',
  backgroundColor: '#1e293b',
  textAlign: 'center' as const,
};

const headerText = {
  color: '#ffffff',
  fontSize: '24px',
  fontWeight: 'bold',
  margin: 0,
};

const content = {
  padding: '0 24px',
};

const greeting = {
  fontSize: '20px',
  lineHeight: '26px',
  color: '#0f172a',
  marginBottom: '16px',
};

const paragraph = {
  fontSize: '16px',
  lineHeight: '24px',
  color: '#475569',
  marginBottom: '16px',
};

const messageBox = {
  backgroundColor: '#f1f5f9',
  borderRadius: '8px',
  padding: '16px',
  margin: '24px 0',
};

const messageLabel = {
  fontSize: '14px',
  fontWeight: 'bold',
  color: '#64748b',
  marginBottom: '8px',
};

const messageText = {
  fontSize: '16px',
  lineHeight: '24px',
  color: '#0f172a',
  margin: 0,
  fontStyle: 'italic',
};

const candlePreview = {
  backgroundColor: '#fffbeb',
  borderRadius: '12px',
  padding: '32px',
  textAlign: 'center' as const,
  margin: '32px 0',
  border: '2px solid #fbbf24',
};

const candleEmoji = {
  fontSize: '64px',
  margin: '0 0 16px',
  lineHeight: '1',
};

const candleTitleText = {
  fontSize: '24px',
  fontWeight: 'bold',
  color: '#0f172a',
  margin: '0 0 8px',
};

const candleTypeText = {
  fontSize: '14px',
  color: '#f59e0b',
  textTransform: 'uppercase' as const,
  letterSpacing: '1px',
  margin: '0 0 16px',
};

const candleMessageText = {
  fontSize: '16px',
  lineHeight: '24px',
  color: '#475569',
  margin: 0,
};

const buttonContainer = {
  textAlign: 'center' as const,
  margin: '32px 0',
};

const button = {
  backgroundColor: '#f59e0b',
  borderRadius: '8px',
  color: '#ffffff',
  fontSize: '16px',
  fontWeight: 'bold',
  textDecoration: 'none',
  textAlign: 'center' as const,
  display: 'inline-block',
  padding: '14px 32px',
};

const divider = {
  borderColor: '#e2e8f0',
  margin: '32px 0',
};

const footerText = {
  fontSize: '14px',
  lineHeight: '20px',
  color: '#64748b',
  margin: '0 0 16px',
};

const footerSmall = {
  fontSize: '12px',
  lineHeight: '18px',
  color: '#94a3b8',
  margin: 0,
};
```

### 2. –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email

```typescript
// lib/email.ts
import { Resend } from 'resend';
import { render } from '@react-email/render';
import { GiftInvitationEmail } from '@/components/email/GiftInvitationEmail';

const resend = new Resend(process.env.RESEND_API_KEY);

interface SendGiftEmailParams {
  recipientEmail: string;
  candleId: string;
  giftToken: string;
  senderName?: string | null;
  senderMessage?: string | null;
  candleTitle: string;
  candleMessage?: string;
  candleType: string;
}

export async function sendGiftEmail(params: SendGiftEmailParams) {
  const { recipientEmail, candleId, giftToken, ...emailProps } = params;

  // URL –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–¥–∞—Ä–∫–∞
  const giftUrl = `${process.env.NEXT_PUBLIC_SITE_URL || 'https://candletime.ru'}/gift/${giftToken}`;

  // –†–µ–Ω–¥–µ—Ä–∏–º HTML email
  const emailHtml = render(
    GiftInvitationEmail({
      ...emailProps,
      giftUrl,
    })
  );

  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º email
  const { data, error } = await resend.emails.send({
    from: 'CandleTime <noreply@candletime.ru>',
    to: recipientEmail,
    subject: emailProps.senderName
      ? `${emailProps.senderName} –ø–æ–¥–∞—Ä–∏–ª(–∞) —Ç–µ–±–µ —Å–≤–µ—á—É`
      : '–¢–µ–±–µ –ø–æ–¥–∞—Ä–∏–ª–∏ —Å–≤–µ—á—É',
    html: emailHtml,
  });

  if (error) {
    console.error('Resend error:', error);
    throw new Error('Failed to send email');
  }

  return data;
}
```

---

## üß© –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞

### 1. –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–¥–∞—Ä–∫–∞

```typescript
// components/gifts/GiftCandleForm.tsx
'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { GiftCandleSchema } from '@/lib/gifts';

interface GiftCandleFormProps {
  onCancel?: () => void;
}

export function GiftCandleForm({ onCancel }: GiftCandleFormProps) {
  const router = useRouter();
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const [formData, setFormData] = useState({
    title: '',
    message: '',
    candle_type: 'gratitude' as const,
    duration_hours: 24,
    recipient_email: '',
    sender_message: '',
    sender_anonymous: false,
  });

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);
    setError(null);

    try {
      // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
      const validated = GiftCandleSchema.parse(formData);

      const response = await fetch('/api/gifts/send', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(validated),
      });

      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø–æ–¥–∞—Ä–∫–∞');
      }

      // –£—Å–ø–µ—Ö!
      router.push(`/gift/sent?candleId=${data.candleId}`);
    } catch (err) {
      if (err instanceof z.ZodError) {
        setError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
      } else {
        setError(err instanceof Error ? err.message : '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞');
      }
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      {/* –í—ã–±–æ—Ä —Ç–∏–ø–∞ —Å–≤–µ—á–∏ */}
      <div>
        <label className="block text-sm font-medium text-slate-700 mb-2">
          –¢–∏–ø —Å–≤–µ—á–∏
        </label>
        <div className="grid grid-cols-5 gap-2">
          {CANDLE_TYPES.map((type) => (
            <button
              key={type.id}
              type="button"
              onClick={() => setFormData({ ...formData, candle_type: type.id })}
              className={`p-3 rounded-lg border-2 transition-all ${
                formData.candle_type === type.id
                  ? 'border-amber-500 bg-amber-50'
                  : 'border-slate-200 hover:border-slate-300'
              }`}
            >
              <span className="text-2xl block mb-1">{type.emoji}</span>
              <span className="text-xs text-slate-600">{type.label}</span>
            </button>
          ))}
        </div>
      </div>

      {/* –ù–∞–∑–≤–∞–Ω–∏–µ —Å–≤–µ—á–∏ */}
      <div>
        <label className="block text-sm font-medium text-slate-700 mb-2">
          –ù–∞–∑–≤–∞–Ω–∏–µ —Å–≤–µ—á–∏ *
        </label>
        <input
          type="text"
          value={formData.title}
          onChange={(e) => setFormData({ ...formData, title: e.target.value })}
          placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –î–ª—è —Ç–µ–±—è"
          maxLength={100}
          required
          className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"
        />
      </div>

      {/* –°–æ–æ–±—â–µ–Ω–∏–µ –∫ —Å–≤–µ—á–µ */}
      <div>
        <label className="block text-sm font-medium text-slate-700 mb-2">
          –°–æ–æ–±—â–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        </label>
        <textarea
          value={formData.message}
          onChange={(e) => setFormData({ ...formData, message: e.target.value })}
          placeholder="–¢–≤–æ—ë –ø–æ—Å–ª–∞–Ω–∏–µ –∫ —Å–≤–µ—á–µ..."
          maxLength={500}
          rows={3}
          className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"
        />
      </div>

      {/* Email –ø–æ–ª—É—á–∞—Ç–µ–ª—è */}
      <div>
        <label className="block text-sm font-medium text-slate-700 mb-2">
          Email –ø–æ–ª—É—á–∞—Ç–µ–ª—è *
        </label>
        <input
          type="email"
          value={formData.recipient_email}
          onChange={(e) =>
            setFormData({ ...formData, recipient_email: e.target.value })
          }
          placeholder="friend@example.com"
          required
          className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"
        />
      </div>

      {/* –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –¥–∞—Ä–∏—Ç–µ–ª—è */}
      <div>
        <label className="block text-sm font-medium text-slate-700 mb-2">
          –¢–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—é (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        </label>
        <textarea
          value={formData.sender_message}
          onChange={(e) =>
            setFormData({ ...formData, sender_message: e.target.value })
          }
          placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –•–æ—á—É –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Ç–µ–±—è –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç..."
          maxLength={500}
          rows={3}
          className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"
        />
      </div>

      {/* –ê–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å */}
      <div className="flex items-center gap-2">
        <input
          type="checkbox"
          id="anonymous"
          checked={formData.sender_anonymous}
          onChange={(e) =>
            setFormData({ ...formData, sender_anonymous: e.target.checked })
          }
          className="rounded border-slate-300 text-amber-500 focus:ring-amber-500"
        />
        <label htmlFor="anonymous" className="text-sm text-slate-700">
          –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–Ω–æ–Ω–∏–º–Ω–æ
        </label>
      </div>

      {/* –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å */}
      <div>
        <label className="block text-sm font-medium text-slate-700 mb-2">
          –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–≤–µ—á–∏
        </label>
        <select
          value={formData.duration_hours}
          onChange={(e) =>
            setFormData({ ...formData, duration_hours: Number(e.target.value) })
          }
          className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500"
        >
          <option value={1}>1 —á–∞—Å</option>
          <option value={24}>1 –¥–µ–Ω—å</option>
          <option value={168}>1 –Ω–µ–¥–µ–ª—è</option>
          <option value={720}>30 –¥–Ω–µ–π</option>
        </select>
      </div>

      {/* –û—à–∏–±–∫–∞ */}
      {error && (
        <div className="p-4 bg-rose-50 border border-rose-200 rounded-lg text-rose-800">
          {error}
        </div>
      )}

      {/* –ö–Ω–æ–ø–∫–∏ */}
      <div className="flex gap-3">
        {onCancel && (
          <button
            type="button"
            onClick={onCancel}
            className="flex-1 px-4 py-2 border border-slate-300 rounded-lg text-slate-700 hover:bg-slate-50"
          >
            –û—Ç–º–µ–Ω–∞
          </button>
        )}
        <button
          type="submit"
          disabled={loading}
          className="flex-1 px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          {loading ? '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º...' : '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫'}
        </button>
      </div>
    </form>
  );
}

const CANDLE_TYPES = [
  { id: 'calm', label: '–°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ', emoji: 'üïäÔ∏è' },
  { id: 'support', label: '–ü–æ–¥–¥–µ—Ä–∂–∫–∞', emoji: 'ü§ù' },
  { id: 'memory', label: '–ü–∞–º—è—Ç—å', emoji: 'üåô' },
  { id: 'gratitude', label: '–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å', emoji: '‚ú®' },
  { id: 'focus', label: '–§–æ–∫—É—Å', emoji: 'üéØ' },
] as const;
```

### 2. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ–¥–∞—Ä–∫–∞

```typescript
// app/[locale]/gift/[token]/page.tsx
'use client';

import { useEffect, useState } from 'react';
import { useParams } from 'next/navigation';
import { supabase } from '@/lib/supabaseClient';
import Link from 'next/link';

export default function GiftPage() {
  const params = useParams();
  const token = params.token as string;
  const [candle, setCandle] = useState<any>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    loadGift();
  }, [token]);

  const loadGift = async () => {
    try {
      const { data, error: fetchError } = await supabase
        .from('candles')
        .select('*, user:users!candles_user_id_fkey(email)')
        .eq('gift_token', token)
        .eq('is_gift', true)
        .single();

      if (fetchError) throw fetchError;
      if (!data) {
        setError('–ü–æ–¥–∞—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
      }

      setCandle(data);

      // –û—Ç–º–µ—á–∞–µ–º, —á—Ç–æ –ø–æ–¥–∞—Ä–æ–∫ –±—ã–ª –æ—Ç–∫—Ä—ã—Ç
      if (!data.gift_opened_at) {
        await supabase
          .from('candles')
          .update({ gift_opened_at: new Date().toISOString() })
          .eq('id', data.id);
      }
    } catch (err) {
      console.error('Error loading gift:', err);
      setError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ–¥–∞—Ä–∫–∞');
    } finally {
      setLoading(false);
    }
  };

  if (loading) {
    return (
      <div className="container mx-auto px-4 py-16 text-center">
        <p className="text-slate-600">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–∞—Ä–∫–∞...</p>
      </div>
    );
  }

  if (error || !candle) {
    return (
      <div className="container mx-auto px-4 py-16 text-center">
        <h1 className="text-2xl font-bold text-slate-900 mb-4">–ü–æ–¥–∞—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω</h1>
        <p className="text-slate-600 mb-6">{error || '–≠—Ç–æ—Ç –ø–æ–¥–∞—Ä–æ–∫ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –±—ã–ª —É–¥–∞–ª–µ–Ω.'}</p>
        <Link
          href="/"
          className="inline-block px-6 py-3 bg-amber-500 text-white rounded-lg hover:bg-amber-600"
        >
          –ù–∞ –≥–ª–∞–≤–Ω—É—é
        </Link>
      </div>
    );
  }

  return (
    <div className="container mx-auto px-4 py-8 max-w-2xl">
      <div className="bg-gradient-to-br from-amber-50 to-amber-100 rounded-2xl p-8 text-center mb-6">
        <h1 className="text-3xl font-bold text-slate-900 mb-2">
          üéÅ –¢–µ–±–µ –ø–æ–¥–∞—Ä–∏–ª–∏ —Å–≤–µ—á—É!
        </h1>
        {!candle.gift_sender_anonymous && candle.user?.email && (
          <p className="text-slate-700">
            –û—Ç <strong>{candle.user.email.split('@')[0]}</strong>
          </p>
        )}
      </div>

      {candle.gift_sender_message && (
        <div className="bg-slate-50 rounded-lg p-6 mb-6">
          <p className="text-slate-600 mb-2">üíå –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –¥–∞—Ä–∏—Ç–µ–ª—è:</p>
          <p className="text-slate-900 text-lg italic">{candle.gift_sender_message}</p>
        </div>
      )}

      {/* –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–≤–µ—á–∏ */}
      <div className="bg-white rounded-lg border border-slate-200 p-8">
        <h2 className="text-2xl font-bold text-slate-900 mb-4">{candle.title}</h2>
        {candle.message && (
          <p className="text-slate-700 mb-6 whitespace-pre-wrap">{candle.message}</p>
        )}
        {/* –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é —Å–≤–µ—á–∏ */}
      </div>

      <div className="mt-6 text-center">
        <Link
          href="/auth/signup"
          className="inline-block px-6 py-3 bg-amber-500 text-white rounded-lg hover:bg-amber-600"
        >
          –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫
        </Link>
      </div>
    </div>
  );
}
```

### 3. –°—Ç—Ä–∞–Ω–∏—Ü–∞ "–ú–Ω–µ –ø–æ–¥–∞—Ä–∏–ª–∏"

```typescript
// app/[locale]/received/page.tsx
'use client';

import { useEffect, useState } from 'react';
import { supabase } from '@/lib/supabaseClient';
import Link from 'next/link';

export default function ReceivedGiftsPage() {
  const [gifts, setGifts] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadGifts();
  }, []);

  const loadGifts = async () => {
    try {
      const {
        data: { user },
      } = await supabase.auth.getUser();

      if (!user) {
        setLoading(false);
        return;
      }

      // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–¥–∞—Ä–∫–∏ –ø–æ email
      const { data: giftsByEmail } = await supabase
        .from('candles')
        .select('*, sender:users!candles_user_id_fkey(email)')
        .eq('is_gift', true)
        .eq('gift_recipient_email', user.email?.toLowerCase())
        .order('gift_sent_at', { ascending: false });

      // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–¥–∞—Ä–∫–∏, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∫ –∞–∫–∫–∞—É–Ω—Ç—É
      const { data: giftsByUserId } = await supabase
        .from('candles')
        .select('*, sender:users!candles_user_id_fkey(email)')
        .eq('is_gift', true)
        .eq('gift_recipient_user_id', user.id)
        .order('gift_sent_at', { ascending: false });

      // –û–±—ä–µ–¥–∏–Ω—è–µ–º –∏ –¥–µ–¥—É–ø–ª–∏—Ü–∏—Ä—É–µ–º
      const allGifts = [...(giftsByEmail || []), ...(giftsByUserId || [])];
      const uniqueGifts = Array.from(
        new Map(allGifts.map((gift) => [gift.id, gift])).values()
      );

      setGifts(uniqueGifts);
    } catch (error) {
      console.error('Error loading gifts:', error);
    } finally {
      setLoading(false);
    }
  };

  if (loading) {
    return (
      <div className="container mx-auto px-4 py-8">
        <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
      </div>
    );
  }

  return (
    <div className="container mx-auto px-4 py-8 max-w-4xl">
      <h1 className="text-3xl font-bold text-slate-900 mb-6">üéÅ –ú–Ω–µ –ø–æ–¥–∞—Ä–∏–ª–∏</h1>

      {gifts.length === 0 ? (
        <div className="text-center py-16">
          <p className="text-slate-600 mb-4">
            –ü–æ–∫–∞ —Ç–µ–±–µ –Ω–µ –¥–∞—Ä–∏–ª–∏ —Å–≤–µ—á–µ–π, –Ω–æ —Ç—ã –º–æ–∂–µ—à—å –±—ã—Ç—å –ø–µ—Ä–≤—ã–º!
          </p>
          <Link
            href="/light"
            className="inline-block px-6 py-3 bg-amber-500 text-white rounded-lg hover:bg-amber-600"
          >
            –ó–∞–∂–µ—á—å —Å–≤–µ—á—É
          </Link>
        </div>
      ) : (
        <div className="grid gap-4 md:grid-cols-2">
          {gifts.map((gift) => (
            <Link
              key={gift.id}
              href={`/candle/${gift.id}`}
              className="bg-white rounded-lg border border-slate-200 p-6 hover:shadow-lg transition-shadow"
            >
              <div className="flex items-start justify-between mb-4">
                <h3 className="text-xl font-bold text-slate-900">{gift.title}</h3>
                <span className="text-2xl">
                  {CANDLE_TYPE_EMOJIS[gift.candle_type] || 'üïØÔ∏è'}
                </span>
              </div>

              {gift.gift_sender_message && (
                <p className="text-slate-600 mb-4 line-clamp-2 italic">
                  "{gift.gift_sender_message}"
                </p>
              )}

              <div className="flex items-center justify-between text-sm text-slate-500">
                <span>
                  {gift.gift_sender_anonymous
                    ? '–ê–Ω–æ–Ω–∏–º–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫'
                    : gift.sender?.email?.split('@')[0] || '–ö—Ç–æ-—Ç–æ'}
                </span>
                <span>
                  {new Date(gift.gift_sent_at).toLocaleDateString('ru-RU')}
                </span>
              </div>
            </Link>
          ))}
        </div>
      )}
    </div>
  );
}

const CANDLE_TYPE_EMOJIS: Record<string, string> = {
  calm: 'üïäÔ∏è',
  support: 'ü§ù',
  memory: 'üåô',
  gratitude: '‚ú®',
  focus: 'üéØ',
};
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∞–Ω—Ç–∏—Å–ø–∞–º

### 1. Rate Limiting

```typescript
// lib/rateLimiter.ts
export async function checkGiftRateLimit(
  senderId: string | null,
  recipientEmail: string
): Promise<{ allowed: boolean; reason?: string }> {
  // –ü—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ canSendGift (—Å–º. –≤—ã—à–µ)
  // + –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 4: –ù–µ –±–æ–ª–µ–µ 3 –ø–æ–¥–∞—Ä–∫–æ–≤ –æ–¥–Ω–æ–º—É email –≤ –¥–µ–Ω—å –æ—Ç –æ–¥–Ω–æ–≥–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
  if (senderId) {
    const todayStart = new Date();
    todayStart.setHours(0, 0, 0, 0);

    const { count } = await supabase
      .from('gift_send_log')
      .select('*', { count: 'exact', head: true })
      .eq('sender_id', senderId)
      .eq('recipient_email', recipientEmail.toLowerCase())
      .gte('sent_at', todayStart.toISOString());

    if (count && count >= 3) {
      return {
        allowed: false,
        reason: '–¢—ã —É–∂–µ –æ—Ç–ø—Ä–∞–≤–∏–ª(–∞) –ø–æ–¥–∞—Ä–æ–∫ —ç—Ç–æ–º—É –ø–æ–ª—É—á–∞—Ç–µ–ª—é —Å–µ–≥–æ–¥–Ω—è',
      };
    }
  }

  return { allowed: true };
}
```

### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è email

```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ/disposable email
const DISPOSABLE_EMAIL_DOMAINS = [
  '10minutemail.com',
  'tempmail.com',
  // ... —Å–ø–∏—Å–æ–∫ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö email —Å–µ—Ä–≤–∏—Å–æ–≤
];

export function isValidEmail(email: string): boolean {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) return false;

  const domain = email.split('@')[1].toLowerCase();
  if (DISPOSABLE_EMAIL_DOMAINS.includes(domain)) {
    return false;
  }

  return true;
}
```

### 3. –ó–∞—â–∏—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤

```typescript
// –¢–æ–∫–µ–Ω—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:
// - –£–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º)
// - –î–ª–∏–Ω–Ω—ã–º–∏ (24+ –±–∞–π—Ç–∞)
// - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è –ø–æ–¥–∞—Ä–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

---

## üìù –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install resend @react-email/components @react-email/render zod
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
RESEND_API_KEY=re_xxxxxxxxxxxxx
NEXT_PUBLIC_SITE_URL=https://candletime.ru
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–í—ã–ø–æ–ª–Ω–∏—Ç—å SQL —Å–∫—Ä–∏–ø—Ç—ã –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"

### –®–∞–≥ 4: –°–æ–∑–¥–∞–Ω–∏–µ —É—Ç–∏–ª–∏—Ç

1. –°–æ–∑–¥–∞—Ç—å `lib/gifts.ts` —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
2. –°–æ–∑–¥–∞—Ç—å `lib/email.ts` —Å —Ñ—É–Ω–∫—Ü–∏–µ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
3. –°–æ–∑–¥–∞—Ç—å `components/email/GiftInvitationEmail.tsx`

### –®–∞–≥ 5: –°–æ–∑–¥–∞–Ω–∏–µ API routes

1. –°–æ–∑–¥–∞—Ç—å `app/api/gifts/send/route.ts`
2. –°–æ–∑–¥–∞—Ç—å `app/api/gifts/list/route.ts` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –®–∞–≥ 6: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

1. –°–æ–∑–¥–∞—Ç—å `components/gifts/GiftCandleForm.tsx`
2. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É `app/[locale]/gift/[token]/page.tsx`
3. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É `app/[locale]/received/page.tsx`

### –®–∞–≥ 7: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

- –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–ü–æ–¥–∞—Ä–∏—Ç—å —Å–≤–µ—á—É" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–æ–∑–¥–∞–Ω–∏—è
- –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É "–ú–Ω–µ –ø–æ–¥–∞—Ä–∏–ª–∏" –≤ —Ö–µ–¥–µ—Ä (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω)

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏:
- ‚úÖ Email –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è > 95% —Å–ª—É—á–∞–µ–≤
- ‚úÖ –í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email < 3 —Å–µ–∫—É–Ω–¥
- ‚úÖ Rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ù–µ—Ç —É—Ç–µ—á–µ–∫ —Ç–æ–∫–µ–Ω–æ–≤

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏:
- ‚úÖ Adoption rate > 25% (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–æ–±—É—é—Ç —Ñ—É–Ω–∫—Ü–∏—é)
- ‚úÖ Conversion rate > 15% (–ø–æ–ª—É—á–∞—Ç–µ–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è)
- ‚úÖ –í–∏—Ä—É—Å–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç > 1.2 (–∫–∞–∂–¥—ã–π –ø–æ–¥–∞—Ä–æ–∫ –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç > 1.2 –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ > 40% (–¥–∞—Ä–∏—Ç–µ–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ)

---

## üöÄ –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –ø–æ —Ñ–∞–∑–∞–º

### –§–∞–∑–∞ 1: –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (1 –Ω–µ–¥–µ–ª—è)
1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î
2. API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
3. Email —à–∞–±–ª–æ–Ω—ã
4. –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–¥–∞—Ä–∫–∞

### –§–∞–∑–∞ 2: –°—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (3-5 –¥–Ω–µ–π)
1. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ–¥–∞—Ä–∫–∞
2. –°—Ç—Ä–∞–Ω–∏—Ü–∞ "–ú–Ω–µ –ø–æ–¥–∞—Ä–∏–ª–∏"
3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### –§–∞–∑–∞ 3: –ó–∞—â–∏—Ç–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (3-5 –¥–Ω–µ–π)
1. Rate limiting
2. –ê–Ω—Ç–∏—Å–ø–∞–º –∑–∞—â–∏—Ç–∞
3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
