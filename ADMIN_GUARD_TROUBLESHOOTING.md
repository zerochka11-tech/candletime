# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å AdminGuard

## –ü—Ä–æ–±–ª–µ–º–∞
–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤–æ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å.

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

### 1. Cookies –Ω–µ —á–∏—Ç–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
**–°–∏–º–ø—Ç–æ–º—ã:** –í—Å–µ–≥–¥–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ –ª–æ–≥–∏–Ω, –¥–∞–∂–µ –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –ò–º–µ–Ω–∞ cookies Supabase (–º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞–∑–Ω—ã–µ –≤ dev/prod)
- –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –≤ cookie
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å cookies –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### 2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞
**–°–∏–º–ø—Ç–æ–º—ã:** –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ç–æ–∫–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:** 
- –î–æ–±–∞–≤–ª–µ–Ω fallback –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö –≤ cookie
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç, –≥–¥–µ –º–æ–∂–µ—Ç –±—ã—Ç—å access_token

### 3. –ü—Ä–æ–±–ª–µ–º–∞ —Å —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–º –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞
**–°–∏–º–ø—Ç–æ–º—ã:** –ü–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞ –ø–æ–ø–∞–¥–∞–µ—Ç–µ –Ω–µ —Ç—É–¥–∞

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
- –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ `signInWithPassword` –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ª–æ–≥–∏–Ω–∞
- –ö—É–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –∞–¥–º–∏–Ω–∞
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `redirect` –≤ URL

## üîß –û—Ç–ª–∞–¥–∫–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–≤—Ä–µ–º–µ–Ω–Ω–æ)

–í `app/admin/components/AdminGuard.tsx` –¥–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

```typescript
console.log('All cookies:', allCookies.map(c => c.name));
console.log('Supabase cookie found:', !!supabaseAuthCookie);
console.log('Session data keys:', sessionData ? Object.keys(sessionData) : 'none');
console.log('Access token found:', !!accessToken);
console.log('User email:', user?.email);
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API Route –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

–°–æ–∑–¥–∞–Ω `/api/admin/check` - –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —á–µ—Ä–µ–∑ fetch.

### –í–∞—Ä–∏–∞–Ω—Ç 3: –í—Ä–µ–º–µ–Ω–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É

–ï—Å–ª–∏ Server Component –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É:

```typescript
// –í page.tsx
useEffect(() => {
  const checkAndRedirect = async () => {
    const { isAdmin } = await checkAdminAccess();
    if (!isAdmin) {
      router.push('/auth/login?redirect=/admin/articles');
    }
  };
  checkAndRedirect();
}, []);
```

## üìã –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `NEXT_PUBLIC_ADMIN_EMAILS` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
2. ‚úÖ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ email –≤ —Å–ø–∏—Å–∫–µ –∞–¥–º–∏–Ω–æ–≤ —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ cookies –¥–æ—Å—Ç—É–ø–Ω—ã (–≤ DevTools ‚Üí Application ‚Üí Cookies)
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç cookie —Å –∏–º–µ–Ω–µ–º `sb-*-auth-token`
5. ‚úÖ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–π—Ç–∏ —á–µ—Ä–µ–∑ `/admin/articles` –Ω–∞–ø—Ä—è–º—É—é –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞

## üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å middleware –≤–º–µ—Å—Ç–æ Server Component:

–°–æ–∑–¥–∞–π—Ç–µ `middleware.ts` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```typescript
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export function middleware(request: NextRequest) {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –∞–¥–º–∏–Ω-—Ä–æ—É—Ç–æ–≤
  if (request.nextUrl.pathname.startsWith('/admin')) {
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —á–µ—Ä–µ–∑ API
    // –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å cookies –Ω–∞–ø—Ä—è–º—É—é
  }
  
  return NextResponse.next();
}

export const config = {
  matcher: '/admin/:path*',
};
```

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

–ü–æ—Å–ª–µ –ª—é–±—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π:
1. –û—á–∏—Å—Ç–∏—Ç–µ cookies –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –í—ã–π–¥–∏—Ç–µ –∏ –≤–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Incognito —Ä–µ–∂–∏–º–µ

